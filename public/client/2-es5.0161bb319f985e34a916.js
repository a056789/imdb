!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function n(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function a(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{WMcg:function(e,n,o){"use strict";o.r(n),o.d(n,"CrupdatePersonModule",(function(){return et}));var i,c=o("ofXK"),b=o("tyNb"),s=o("mrSG"),p=o("AcyG"),l=function(){var t=function t(e){r(this,t),this.id=e};return t.type="[CrupdatePerson] Load Person",t}(),u=function(){var t=function t(e){r(this,t),this.id=e};return t.type="[CrupdatePerson] Detach Credit",t}(),d=function(){var t=function t(e){r(this,t),this.payload=e};return t.type="[CrupdatePerson] Create Person",t}(),f=function(){var t=function t(e){r(this,t),this.payload=e};return t.type="[CrupdatePerson] Update Person",t}(),m=function(){var t=function t(){r(this,t)};return t.type="[CrupdatePerson] Reset State",t}(),h=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var n in r(this,t),e)this[n]=e[n]},g=o("vkgz"),y=o("nYR2"),v=o("fXoL"),V=o("ZQmV"),C=o("7tLl"),O=((i=function(){function e(t,n){r(this,e),this.people=t,this.titles=n}return a(e,[{key:"loadPerson",value:function(t,e){var n=this;return t.patchState({loading:!0}),this.people.get(e.id).pipe(Object(g.a)((function(e){t.patchState({person:e.person,credits:n.flattenCredits(e.credits),loading:!1})})))}},{key:"createPerson",value:function(t,e){return t.patchState({loading:!0}),this.people.create(e.payload).pipe(Object(y.a)((function(){return t.patchState({loading:!1})})),Object(g.a)((function(e){return t.patchState({person:e.person})})))}},{key:"updatePerson",value:function(t,e){return t.patchState({loading:!0}),this.people.update(t.getState().person.id,e.payload).pipe(Object(y.a)((function(){return t.patchState({loading:!1})})),Object(g.a)((function(e){return t.patchState({person:e.person})})))}},{key:"removeCredit",value:function(t,e){return t.patchState({loading:!0}),this.titles.removeCredit(e.id).pipe(Object(g.a)((function(){var n=t.getState().credits.filter((function(t){return t.pivot.id!==e.id}));t.patchState({credits:n})})),Object(y.a)((function(){return t.patchState({loading:!1})})))}},{key:"resetState",value:function(t){t.patchState({person:new h,credits:[],loading:!1})}},{key:"flattenCredits",value:function(e){var n=[];return Object.keys(e).forEach((function(a){n.push.apply(n,t(e[a]))})),n}}],[{key:"person",value:function(t){return t.person}},{key:"loading",value:function(t){return t.loading}},{key:"credits",value:function(t){return t.credits}}]),e}()).\u0275fac=function(t){return new(t||i)(v.ac(V.a),v.ac(C.a))},i.\u0275prov=v.Mb({token:i,factory:i.\u0275fac}),Object(s.b)([Object(p.a)(l)],i.prototype,"loadPerson",null),Object(s.b)([Object(p.a)(d)],i.prototype,"createPerson",null),Object(s.b)([Object(p.a)(f)],i.prototype,"updatePerson",null),Object(s.b)([Object(p.a)(u)],i.prototype,"removeCredit",null),Object(s.b)([Object(p.a)(m)],i.prototype,"resetState",null),Object(s.b)([Object(p.e)()],i,"person",null),Object(s.b)([Object(p.e)()],i,"loading",null),Object(s.b)([Object(p.e)()],i,"credits",null),i=Object(s.b)([Object(p.f)({name:"crupdatePerson",defaults:{person:new h,credits:[],loading:!1}})],i)),W=o("2Vo4"),P=o("r2Ys"),_=o("h586"),j=o("Lm4C"),w=o("QeDF"),x=o("2hX1"),S=o("i2dy"),k=o("3Pt+"),M=o("wZkO"),L=o("l9qf"),D=o("bTqV"),R=o("Rd8u"),N=o("Qu3c"),F=o("NFeN"),A=o("ihCf"),E=o("EAOp"),I=o("Um6Z"),z=o("FBzJ"),Q=o("CH4Q"),$=o("zW5C");function T(t,e){if(1&t){var n=v.Xb();v.Wb(0,"tr"),v.Wb(1,"td"),v.Wb(2,"div",45),v.Rb(3,"media-image",46),v.Wb(4,"span"),v.Lc(5),v.Vb(),v.Vb(),v.Vb(),v.Wb(6,"td",47),v.Lc(7),v.Vb(),v.Wb(8,"td",48),v.Lc(9),v.Vb(),v.Wb(10,"td",49),v.Lc(11),v.Vb(),v.Wb(12,"td",50),v.Wb(13,"button",51),v.dc("click",(function(){v.Ac(n);var t=e.$implicit;return v.hc().detachCredit(t)})),v.Rb(14,"mat-icon",52),v.Vb(),v.Vb(),v.Vb()}if(2&t){var a=e.$implicit;v.Db(3),v.pc("src",a.poster),v.Db(2),v.Mc(a.name),v.Db(2),v.Mc(null!=a.pivot&&a.pivot.character?a.pivot.character:"-"),v.Db(2),v.Nc("",null!=a.pivot&&a.pivot.department?a.pivot.department:"-"," "),v.Db(2),v.Mc(null!=a.pivot&&a.pivot.job?a.pivot.job:"-")}}function U(t,e){1&t&&(v.Wb(0,"no-results-message",53),v.Wb(1,"span",54),v.Lc(2,"Nothing to display."),v.Vb(),v.Vb())}var J,G,q,X=[{path:"",component:(J=function(){function t(e,n,a,o,i,c,b){r(this,t),this.store=e,this.toast=n,this.router=a,this.fb=o,this.route=i,this.uploadQueue=c,this.datatable=b,this.poster$=new W.a(null),this.personForm=this.fb.group({name:[""],poster:[""],popularity:[""],description:[""],known_for:[""],birth_place:[""],birth_date:[""],death_date:[""],gender:[null],allow_update:[!0]})}return a(t,[{key:"ngOnInit",value:function(){var t=this;this.datatable.init(),this.route.params.subscribe((function(e){t.loadPerson(e)})),this.store.select(O.credits).subscribe((function(e){t.datatable.data=e})),this.personForm.get("poster").valueChanges.subscribe((function(e){t.poster$.next(e)}))}},{key:"ngOnDestroy",value:function(){this.store.dispatch(new m),this.datatable.destroy()}},{key:"uploadPoster",value:function(){var t=this;Object(j.a)({types:[w.a.image]}).then((function(e){t.uploadQueue.start(e,{uri:"uploads/images",httpParams:{diskPrefix:"media-images/posters"}}).subscribe((function(e){t.personForm.patchValue({poster:e.fileEntry.url})}))}))}},{key:"loadPerson",value:function(t){var e=this;t.id&&this.store.dispatch(new l(+t.id)).subscribe((function(){var t=e.store.selectSnapshot(O.person);e.personForm.patchValue(t),e.poster$.next(t.poster)}))}},{key:"submit",value:function(){var t=this,e=this.store.selectSnapshot(O.person);this.store.dispatch(e.id?new f(this.personForm.value):new d(this.personForm.value)).subscribe((function(){t.router.navigate([t.router.url.includes("admin")?"admin/people":t.router.url.split("?")[0].replace("/edit","")]),t.toast.open(e.id?P.a.PERSON_UPDATE_SUCCESS:P.a.PERSON_CREATE_SUCCESS)}))}},{key:"detachCredit",value:function(t){var e=this;t.pivot&&this.store.dispatch(new u(t.pivot.id)).subscribe((function(){e.toast.open(P.a.CREDIT_REMOVE_SUCCESS)}))}}]),t}(),J.\u0275fac=function(t){return new(t||J)(v.Qb(p.g),v.Qb(S.b),v.Qb(b.d),v.Qb(k.h),v.Qb(b.a),v.Qb(_.a),v.Qb(x.a))},J.\u0275cmp=v.Kb({type:J,selectors:[["crupdate-person-page"]],features:[v.Cb([_.a,x.a])],decls:90,vars:25,consts:[["animationDuration","0ms","color","accent",1,"material-panel"],[3,"label"],["ngNativeValidate","",1,"primary-facts-panel",3,"formGroup","ngSubmit"],[1,"left-col"],["size","medium",3,"src"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"right-col","many-inputs"],[1,"inline-container","many-inputs"],[1,"input-container"],["for","name","trans",""],["type","text","formControlName","name","id","name","required",""],["for","known_for","trans",""],["type","text","formControlName","known_for","id","known_for"],["for","poster","trans",""],[1,"input-with-action","action-left"],["type","button","mat-flat-button","","color","accent",3,"matTooltip","click"],["svgIcon","file-upload"],["type","text","formControlName","poster","id","poster","minlength","1","maxlength","250"],["for","description","trans",""],["id","description","formControlName","description","cdkTextareaAutosize","","cdkAutosizeMinRows","10","cdkAutosizeMaxRows","100"],["for","gender","trans",""],["id","gender","formControlName","gender"],[3,"ngValue"],["value","male","trans",""],["value","female","trans",""],["for","birth_date","trans",""],["type","date","id","birth_date","formControlName","birth_date"],["for","death_date","trans",""],["type","date","id","death_date","formControlName","death_date"],["for","popularity","trans",""],["type","number","formControlName","popularity","id","popularity","min","1","max","1000","step","0.1"],["for","birth_place","trans",""],["type","text","id","birth_place","formControlName","birth_place"],["for","allow_update","trans",""],["formControlName","allow_update","id","allow_update","required",""],["trans","",3,"ngValue"],[1,"responsive-table"],[1,"material-table"],["table-sort-header","name","trans",""],["table-sort-header","pivot.character","trans",""],["table-sort-header","pivot.department","trans",""],["table-sort-header","pivot.job","trans",""],[4,"ngFor","ngForOf"],["svgImage","awards.svg",4,"ngIf"],[1,"overlay",3,"isVisible"],[1,"column-with-image"],["size","small",3,"src"],["data-label","Character",1,"capitalize"],["data-label","Department",1,"capitalize"],["data-label","Job",1,"capitalize"],[1,"edit-column"],["type","button","mat-icon-button","",3,"click"],["svgIcon","close"],["svgImage","awards.svg"],["primary-text","","trans",""]],template:function(t,e){1&t&&(v.Wb(0,"mat-tab-group",0),v.Wb(1,"mat-tab",1),v.ic(2,"trans"),v.Wb(3,"form",2),v.dc("ngSubmit",(function(){return e.submit()})),v.Wb(4,"div",3),v.Rb(5,"media-image",4),v.ic(6,"async"),v.Wb(7,"button",5),v.Lc(8,"Save"),v.Vb(),v.Vb(),v.Wb(9,"div",6),v.Wb(10,"div",7),v.Wb(11,"div",8),v.Wb(12,"label",9),v.Lc(13,"Name"),v.Vb(),v.Rb(14,"input",10),v.Vb(),v.Wb(15,"div",8),v.Wb(16,"label",11),v.Lc(17,"Known For"),v.Vb(),v.Rb(18,"input",12),v.Vb(),v.Vb(),v.Wb(19,"div",8),v.Wb(20,"label",13),v.Lc(21,"Image"),v.Vb(),v.Wb(22,"div",14),v.Wb(23,"button",15),v.dc("click",(function(){return e.uploadPoster()})),v.ic(24,"trans"),v.Rb(25,"mat-icon",16),v.Vb(),v.Rb(26,"input",17),v.Vb(),v.Vb(),v.Wb(27,"div",8),v.Wb(28,"label",18),v.Lc(29,"Biography"),v.Vb(),v.Rb(30,"textarea",19),v.Vb(),v.Wb(31,"div",7),v.Wb(32,"div",8),v.Wb(33,"label",20),v.Lc(34,"Gender"),v.Vb(),v.Wb(35,"select",21),v.Wb(36,"option",22),v.Lc(37,"-"),v.Vb(),v.Wb(38,"option",23),v.Lc(39,"Male"),v.Vb(),v.Wb(40,"option",24),v.Lc(41,"Female"),v.Vb(),v.Vb(),v.Vb(),v.Wb(42,"div",8),v.Wb(43,"label",25),v.Lc(44,"Birth Date"),v.Vb(),v.Rb(45,"input",26),v.Vb(),v.Wb(46,"div",8),v.Wb(47,"label",27),v.Lc(48,"Death Date"),v.Vb(),v.Rb(49,"input",28),v.Vb(),v.Vb(),v.Wb(50,"div",7),v.Wb(51,"div",8),v.Wb(52,"label",29),v.Lc(53,"Popularity"),v.Vb(),v.Rb(54,"input",30),v.Vb(),v.Wb(55,"div",8),v.Wb(56,"label",31),v.Lc(57,"Birth Place"),v.Vb(),v.Rb(58,"input",32),v.Vb(),v.Wb(59,"div",8),v.Wb(60,"label",33),v.Lc(61,"Allow Auto Update"),v.Vb(),v.Wb(62,"select",34),v.Wb(63,"option",35),v.Lc(64,"Yes"),v.Vb(),v.Wb(65,"option",35),v.Lc(66,"No"),v.Vb(),v.Vb(),v.Vb(),v.Vb(),v.Vb(),v.Vb(),v.Vb(),v.Wb(67,"mat-tab",1),v.ic(68,"trans"),v.Wb(69,"div",36),v.Rb(70,"datatable-header"),v.Wb(71,"table",37),v.Wb(72,"thead"),v.Wb(73,"tr"),v.Wb(74,"th",38),v.Lc(75,"Credit"),v.Vb(),v.Wb(76,"th",39),v.Lc(77,"Character"),v.Vb(),v.Wb(78,"th",40),v.Lc(79,"Department"),v.Vb(),v.Wb(80,"th",41),v.Lc(81,"Job"),v.Vb(),v.Rb(82,"th"),v.Vb(),v.Vb(),v.Wb(83,"tbody"),v.Jc(84,T,15,5,"tr",42),v.ic(85,"async"),v.Vb(),v.Vb(),v.Jc(86,U,3,0,"no-results-message",43),v.ic(87,"async"),v.Vb(),v.Vb(),v.Vb(),v.Rb(88,"loading-indicator",44),v.ic(89,"async")),2&t&&(v.Db(1),v.pc("label",v.jc(2,11,"Primary Facts")),v.Db(2),v.pc("formGroup",e.personForm),v.Db(2),v.pc("src",v.jc(6,13,e.poster$)),v.Db(18),v.pc("matTooltip",v.jc(24,15,"Upload poster")),v.Db(13),v.pc("ngValue",null),v.Db(27),v.pc("ngValue",!0),v.Db(2),v.pc("ngValue",!1),v.Db(2),v.pc("label",v.jc(68,17,"Credits")),v.Db(17),v.pc("ngForOf",v.jc(85,19,e.datatable.data$)),v.Db(2),v.pc("ngIf",!v.jc(87,21,e.datatable.data$).length),v.Db(2),v.pc("isVisible",v.jc(89,23,e.loading$)))},directives:[M.c,M.a,k.v,k.m,L.a,D.b,R.a,k.d,k.u,k.k,k.F,N.a,F.a,k.q,k.p,A.b,k.G,k.z,k.J,k.A,E.a,I.a,c.s,c.t,z.a,Q.a],pipes:[$.a,c.b],styles:["[_nghost-%COMP%]{display:block;width:100%}[_nghost-%COMP%]     .mat-tab-body-wrapper{padding:20px 0}[_nghost-%COMP%]     .mat-tab-label-content{text-transform:capitalize}[_nghost-%COMP%]     datatable-header .left-column{display:none}[_nghost-%COMP%]     datatable-header .right-column{margin:0}[_nghost-%COMP%]     datatable-header .input-container{width:400px}.inline-container[_ngcontent-%COMP%]{display:flex}.inline-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{flex:1 1 auto}.inline-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:not(:last-of-type){margin-right:15px}.inline-container[_ngcontent-%COMP%]   .input-container.size-small[_ngcontent-%COMP%]{flex:1 1 30%}.mat-tab-group[_ngcontent-%COMP%]{margin-bottom:25px}.primary-facts-panel[_ngcontent-%COMP%]{display:flex}.primary-facts-panel[_ngcontent-%COMP%]   .left-col[_ngcontent-%COMP%]{flex:0 0 200px;width:200px;margin-right:25px}.primary-facts-panel[_ngcontent-%COMP%]   .right-col[_ngcontent-%COMP%]{flex:1 1 auto}.primary-facts-panel[_ngcontent-%COMP%]   media-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);border-radius:4px}.primary-facts-panel[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{width:100%;margin-top:15px;min-height:45px}no-results-message[_ngcontent-%COMP%]{margin:50px 0 40px}"],changeDetection:0}),Object(s.b)([Object(p.d)(O.loading)],J.prototype,"loading$",void 0),Object(s.b)([Object(p.d)(O.credits)],J.prototype,"credits$",void 0),J),data:{permissions:["people.update"]}}],B=((G=function t(){r(this,t)}).\u0275mod=v.Ob({type:G}),G.\u0275inj=v.Nb({factory:function(t){return new(t||G)},imports:[[b.h.forChild(X)],b.h]}),G),Z=o("6rvT"),K=o("ZFTr"),Y=o("Iysn"),H=o("X3pI"),tt=o("1ImS"),et=((q=function t(){r(this,t)}).\u0275mod=v.Ob({type:q}),q.\u0275inj=v.Nb({factory:function(t){return new(t||q)},imports:[[c.c,B,Z.a,k.o,k.E,K.a,Y.a,H.a,tt.a,p.c.forFeature([O]),M.g,D.c,F.b,N.b,A.c]]}),q)}}])}();
//# sourceMappingURL=2-es5.0161bb319f985e34a916.js.map