(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{WMcg:function(t,e,a){"use strict";a.r(e),a.d(e,"CrupdatePersonModule",(function(){return X}));var n=a("ofXK"),r=a("tyNb"),o=a("mrSG"),i=a("AcyG");let s=(()=>{class t{constructor(t){this.id=t}}return t.type="[CrupdatePerson] Load Person",t})(),c=(()=>{class t{constructor(t){this.id=t}}return t.type="[CrupdatePerson] Detach Credit",t})(),b=(()=>{class t{constructor(t){this.payload=t}}return t.type="[CrupdatePerson] Create Person",t})(),p=(()=>{class t{constructor(t){this.payload=t}}return t.type="[CrupdatePerson] Update Person",t})(),l=(()=>{class t{}return t.type="[CrupdatePerson] Reset State",t})();class d{constructor(t={}){for(const e in t)this[e]=t[e]}}var u=a("vkgz"),h=a("nYR2"),m=a("fXoL"),g=a("ZQmV"),f=a("7tLl");let V=(()=>{let t=class{constructor(t,e){this.people=t,this.titles=e}static person(t){return t.person}static loading(t){return t.loading}static credits(t){return t.credits}loadPerson(t,e){return t.patchState({loading:!0}),this.people.get(e.id).pipe(Object(u.a)(e=>{t.patchState({person:e.person,credits:this.flattenCredits(e.credits),loading:!1})}))}createPerson(t,e){return t.patchState({loading:!0}),this.people.create(e.payload).pipe(Object(h.a)(()=>t.patchState({loading:!1})),Object(u.a)(e=>t.patchState({person:e.person})))}updatePerson(t,e){return t.patchState({loading:!0}),this.people.update(t.getState().person.id,e.payload).pipe(Object(h.a)(()=>t.patchState({loading:!1})),Object(u.a)(e=>t.patchState({person:e.person})))}removeCredit(t,e){return t.patchState({loading:!0}),this.titles.removeCredit(e.id).pipe(Object(u.a)(()=>{const a=t.getState().credits.filter(t=>t.pivot.id!==e.id);t.patchState({credits:a})}),Object(h.a)(()=>t.patchState({loading:!1})))}resetState(t){t.patchState({person:new d,credits:[],loading:!1})}flattenCredits(t){const e=[];return Object.keys(t).forEach(a=>{e.push(...t[a])}),e}};return t.\u0275fac=function(e){return new(e||t)(m.ac(g.a),m.ac(f.a))},t.\u0275prov=m.Mb({token:t,factory:t.\u0275fac}),Object(o.b)([Object(i.a)(s)],t.prototype,"loadPerson",null),Object(o.b)([Object(i.a)(b)],t.prototype,"createPerson",null),Object(o.b)([Object(i.a)(p)],t.prototype,"updatePerson",null),Object(o.b)([Object(i.a)(c)],t.prototype,"removeCredit",null),Object(o.b)([Object(i.a)(l)],t.prototype,"resetState",null),Object(o.b)([Object(i.e)()],t,"person",null),Object(o.b)([Object(i.e)()],t,"loading",null),Object(o.b)([Object(i.e)()],t,"credits",null),t=Object(o.b)([Object(i.f)({name:"crupdatePerson",defaults:{person:new d,credits:[],loading:!1}})],t),t})();var y=a("2Vo4"),C=a("r2Ys"),O=a("h586"),v=a("Lm4C"),W=a("QeDF"),P=a("2hX1"),_=a("i2dy"),j=a("3Pt+"),w=a("wZkO"),x=a("l9qf"),M=a("bTqV"),S=a("Rd8u"),L=a("Qu3c"),D=a("NFeN"),R=a("ihCf"),N=a("EAOp"),k=a("Um6Z"),F=a("FBzJ"),E=a("CH4Q"),z=a("zW5C");function Q(t,e){if(1&t){const t=m.Xb();m.Wb(0,"tr"),m.Wb(1,"td"),m.Wb(2,"div",45),m.Rb(3,"media-image",46),m.Wb(4,"span"),m.Lc(5),m.Vb(),m.Vb(),m.Vb(),m.Wb(6,"td",47),m.Lc(7),m.Vb(),m.Wb(8,"td",48),m.Lc(9),m.Vb(),m.Wb(10,"td",49),m.Lc(11),m.Vb(),m.Wb(12,"td",50),m.Wb(13,"button",51),m.dc("click",(function(){m.Ac(t);const a=e.$implicit;return m.hc().detachCredit(a)})),m.Rb(14,"mat-icon",52),m.Vb(),m.Vb(),m.Vb()}if(2&t){const t=e.$implicit;m.Db(3),m.pc("src",t.poster),m.Db(2),m.Mc(t.name),m.Db(2),m.Mc(null!=t.pivot&&t.pivot.character?t.pivot.character:"-"),m.Db(2),m.Nc("",null!=t.pivot&&t.pivot.department?t.pivot.department:"-"," "),m.Db(2),m.Mc(null!=t.pivot&&t.pivot.job?t.pivot.job:"-")}}function I(t,e){1&t&&(m.Wb(0,"no-results-message",53),m.Wb(1,"span",54),m.Lc(2,"Nothing to display."),m.Vb(),m.Vb())}const A=[{path:"",component:(()=>{class t{constructor(t,e,a,n,r,o,i){this.store=t,this.toast=e,this.router=a,this.fb=n,this.route=r,this.uploadQueue=o,this.datatable=i,this.poster$=new y.a(null),this.personForm=this.fb.group({name:[""],poster:[""],popularity:[""],description:[""],known_for:[""],birth_place:[""],birth_date:[""],death_date:[""],gender:[null],allow_update:[!0]})}ngOnInit(){this.datatable.init(),this.route.params.subscribe(t=>{this.loadPerson(t)}),this.store.select(V.credits).subscribe(t=>{this.datatable.data=t}),this.personForm.get("poster").valueChanges.subscribe(t=>{this.poster$.next(t)})}ngOnDestroy(){this.store.dispatch(new l),this.datatable.destroy()}uploadPoster(){Object(v.a)({types:[W.a.image]}).then(t=>{this.uploadQueue.start(t,{uri:"uploads/images",httpParams:{diskPrefix:"media-images/posters"}}).subscribe(t=>{this.personForm.patchValue({poster:t.fileEntry.url})})})}loadPerson(t){t.id&&this.store.dispatch(new s(+t.id)).subscribe(()=>{const t=this.store.selectSnapshot(V.person);this.personForm.patchValue(t),this.poster$.next(t.poster)})}submit(){const t=this.store.selectSnapshot(V.person);this.store.dispatch(t.id?new p(this.personForm.value):new b(this.personForm.value)).subscribe(()=>{this.router.navigate([this.router.url.includes("admin")?"admin/people":this.router.url.split("?")[0].replace("/edit","")]),this.toast.open(t.id?C.a.PERSON_UPDATE_SUCCESS:C.a.PERSON_CREATE_SUCCESS)})}detachCredit(t){t.pivot&&this.store.dispatch(new c(t.pivot.id)).subscribe(()=>{this.toast.open(C.a.CREDIT_REMOVE_SUCCESS)})}}return t.\u0275fac=function(e){return new(e||t)(m.Qb(i.g),m.Qb(_.b),m.Qb(r.d),m.Qb(j.h),m.Qb(r.a),m.Qb(O.a),m.Qb(P.a))},t.\u0275cmp=m.Kb({type:t,selectors:[["crupdate-person-page"]],features:[m.Cb([O.a,P.a])],decls:90,vars:25,consts:[["animationDuration","0ms","color","accent",1,"material-panel"],[3,"label"],["ngNativeValidate","",1,"primary-facts-panel",3,"formGroup","ngSubmit"],[1,"left-col"],["size","medium",3,"src"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"right-col","many-inputs"],[1,"inline-container","many-inputs"],[1,"input-container"],["for","name","trans",""],["type","text","formControlName","name","id","name","required",""],["for","known_for","trans",""],["type","text","formControlName","known_for","id","known_for"],["for","poster","trans",""],[1,"input-with-action","action-left"],["type","button","mat-flat-button","","color","accent",3,"matTooltip","click"],["svgIcon","file-upload"],["type","text","formControlName","poster","id","poster","minlength","1","maxlength","250"],["for","description","trans",""],["id","description","formControlName","description","cdkTextareaAutosize","","cdkAutosizeMinRows","10","cdkAutosizeMaxRows","100"],["for","gender","trans",""],["id","gender","formControlName","gender"],[3,"ngValue"],["value","male","trans",""],["value","female","trans",""],["for","birth_date","trans",""],["type","date","id","birth_date","formControlName","birth_date"],["for","death_date","trans",""],["type","date","id","death_date","formControlName","death_date"],["for","popularity","trans",""],["type","number","formControlName","popularity","id","popularity","min","1","max","1000","step","0.1"],["for","birth_place","trans",""],["type","text","id","birth_place","formControlName","birth_place"],["for","allow_update","trans",""],["formControlName","allow_update","id","allow_update","required",""],["trans","",3,"ngValue"],[1,"responsive-table"],[1,"material-table"],["table-sort-header","name","trans",""],["table-sort-header","pivot.character","trans",""],["table-sort-header","pivot.department","trans",""],["table-sort-header","pivot.job","trans",""],[4,"ngFor","ngForOf"],["svgImage","awards.svg",4,"ngIf"],[1,"overlay",3,"isVisible"],[1,"column-with-image"],["size","small",3,"src"],["data-label","Character",1,"capitalize"],["data-label","Department",1,"capitalize"],["data-label","Job",1,"capitalize"],[1,"edit-column"],["type","button","mat-icon-button","",3,"click"],["svgIcon","close"],["svgImage","awards.svg"],["primary-text","","trans",""]],template:function(t,e){1&t&&(m.Wb(0,"mat-tab-group",0),m.Wb(1,"mat-tab",1),m.ic(2,"trans"),m.Wb(3,"form",2),m.dc("ngSubmit",(function(){return e.submit()})),m.Wb(4,"div",3),m.Rb(5,"media-image",4),m.ic(6,"async"),m.Wb(7,"button",5),m.Lc(8,"Save"),m.Vb(),m.Vb(),m.Wb(9,"div",6),m.Wb(10,"div",7),m.Wb(11,"div",8),m.Wb(12,"label",9),m.Lc(13,"Name"),m.Vb(),m.Rb(14,"input",10),m.Vb(),m.Wb(15,"div",8),m.Wb(16,"label",11),m.Lc(17,"Known For"),m.Vb(),m.Rb(18,"input",12),m.Vb(),m.Vb(),m.Wb(19,"div",8),m.Wb(20,"label",13),m.Lc(21,"Image"),m.Vb(),m.Wb(22,"div",14),m.Wb(23,"button",15),m.dc("click",(function(){return e.uploadPoster()})),m.ic(24,"trans"),m.Rb(25,"mat-icon",16),m.Vb(),m.Rb(26,"input",17),m.Vb(),m.Vb(),m.Wb(27,"div",8),m.Wb(28,"label",18),m.Lc(29,"Biography"),m.Vb(),m.Rb(30,"textarea",19),m.Vb(),m.Wb(31,"div",7),m.Wb(32,"div",8),m.Wb(33,"label",20),m.Lc(34,"Gender"),m.Vb(),m.Wb(35,"select",21),m.Wb(36,"option",22),m.Lc(37,"-"),m.Vb(),m.Wb(38,"option",23),m.Lc(39,"Male"),m.Vb(),m.Wb(40,"option",24),m.Lc(41,"Female"),m.Vb(),m.Vb(),m.Vb(),m.Wb(42,"div",8),m.Wb(43,"label",25),m.Lc(44,"Birth Date"),m.Vb(),m.Rb(45,"input",26),m.Vb(),m.Wb(46,"div",8),m.Wb(47,"label",27),m.Lc(48,"Death Date"),m.Vb(),m.Rb(49,"input",28),m.Vb(),m.Vb(),m.Wb(50,"div",7),m.Wb(51,"div",8),m.Wb(52,"label",29),m.Lc(53,"Popularity"),m.Vb(),m.Rb(54,"input",30),m.Vb(),m.Wb(55,"div",8),m.Wb(56,"label",31),m.Lc(57,"Birth Place"),m.Vb(),m.Rb(58,"input",32),m.Vb(),m.Wb(59,"div",8),m.Wb(60,"label",33),m.Lc(61,"Allow Auto Update"),m.Vb(),m.Wb(62,"select",34),m.Wb(63,"option",35),m.Lc(64,"Yes"),m.Vb(),m.Wb(65,"option",35),m.Lc(66,"No"),m.Vb(),m.Vb(),m.Vb(),m.Vb(),m.Vb(),m.Vb(),m.Vb(),m.Wb(67,"mat-tab",1),m.ic(68,"trans"),m.Wb(69,"div",36),m.Rb(70,"datatable-header"),m.Wb(71,"table",37),m.Wb(72,"thead"),m.Wb(73,"tr"),m.Wb(74,"th",38),m.Lc(75,"Credit"),m.Vb(),m.Wb(76,"th",39),m.Lc(77,"Character"),m.Vb(),m.Wb(78,"th",40),m.Lc(79,"Department"),m.Vb(),m.Wb(80,"th",41),m.Lc(81,"Job"),m.Vb(),m.Rb(82,"th"),m.Vb(),m.Vb(),m.Wb(83,"tbody"),m.Jc(84,Q,15,5,"tr",42),m.ic(85,"async"),m.Vb(),m.Vb(),m.Jc(86,I,3,0,"no-results-message",43),m.ic(87,"async"),m.Vb(),m.Vb(),m.Vb(),m.Rb(88,"loading-indicator",44),m.ic(89,"async")),2&t&&(m.Db(1),m.pc("label",m.jc(2,11,"Primary Facts")),m.Db(2),m.pc("formGroup",e.personForm),m.Db(2),m.pc("src",m.jc(6,13,e.poster$)),m.Db(18),m.pc("matTooltip",m.jc(24,15,"Upload poster")),m.Db(13),m.pc("ngValue",null),m.Db(27),m.pc("ngValue",!0),m.Db(2),m.pc("ngValue",!1),m.Db(2),m.pc("label",m.jc(68,17,"Credits")),m.Db(17),m.pc("ngForOf",m.jc(85,19,e.datatable.data$)),m.Db(2),m.pc("ngIf",!m.jc(87,21,e.datatable.data$).length),m.Db(2),m.pc("isVisible",m.jc(89,23,e.loading$)))},directives:[w.c,w.a,j.v,j.m,x.a,M.b,S.a,j.d,j.u,j.k,j.F,L.a,D.a,j.q,j.p,R.b,j.G,j.z,j.J,j.A,N.a,k.a,n.s,n.t,F.a,E.a],pipes:[z.a,n.b],styles:["[_nghost-%COMP%]{display:block;width:100%}[_nghost-%COMP%]     .mat-tab-body-wrapper{padding:20px 0}[_nghost-%COMP%]     .mat-tab-label-content{text-transform:capitalize}[_nghost-%COMP%]     datatable-header .left-column{display:none}[_nghost-%COMP%]     datatable-header .right-column{margin:0}[_nghost-%COMP%]     datatable-header .input-container{width:400px}.inline-container[_ngcontent-%COMP%]{display:flex}.inline-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{flex:1 1 auto}.inline-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]:not(:last-of-type){margin-right:15px}.inline-container[_ngcontent-%COMP%]   .input-container.size-small[_ngcontent-%COMP%]{flex:1 1 30%}.mat-tab-group[_ngcontent-%COMP%]{margin-bottom:25px}.primary-facts-panel[_ngcontent-%COMP%]{display:flex}.primary-facts-panel[_ngcontent-%COMP%]   .left-col[_ngcontent-%COMP%]{flex:0 0 200px;width:200px;margin-right:25px}.primary-facts-panel[_ngcontent-%COMP%]   .right-col[_ngcontent-%COMP%]{flex:1 1 auto}.primary-facts-panel[_ngcontent-%COMP%]   media-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);border-radius:4px}.primary-facts-panel[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{width:100%;margin-top:15px;min-height:45px}no-results-message[_ngcontent-%COMP%]{margin:50px 0 40px}"],changeDetection:0}),Object(o.b)([Object(i.d)(V.loading)],t.prototype,"loading$",void 0),Object(o.b)([Object(i.d)(V.credits)],t.prototype,"credits$",void 0),t})(),data:{permissions:["people.update"]}}];let $=(()=>{class t{}return t.\u0275mod=m.Ob({type:t}),t.\u0275inj=m.Nb({factory:function(e){return new(e||t)},imports:[[r.h.forChild(A)],r.h]}),t})();var T=a("6rvT"),J=a("ZFTr"),U=a("Iysn"),G=a("X3pI"),q=a("1ImS");let X=(()=>{class t{}return t.\u0275mod=m.Ob({type:t}),t.\u0275inj=m.Nb({factory:function(e){return new(e||t)},imports:[[n.c,$,T.a,j.o,j.E,J.a,U.a,G.a,q.a,i.c.forFeature([V]),w.g,M.c,D.b,L.b,R.c]]}),t})()}}]);
//# sourceMappingURL=2-es2015.0161bb319f985e34a916.js.map